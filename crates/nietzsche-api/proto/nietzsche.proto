syntax = "proto3";

package nietzsche;

// ── NietzscheDB unified gRPC API ──────────────────────────────────────────
//
// Exposes all core subsystems over a single service:
//   • Collection management (create, drop, list)
//   • Graph CRUD  (nodes + edges)
//   • NQL queries (Nietzsche Query Language, Phase 4)
//   • Vector KNN  (Poincaré ball nearest-neighbour search)
//   • Traversal   (BFS, Dijkstra)
//   • Diffusion   (Chebyshev heat-kernel, Phase 6)
//   • Sleep cycle (Riemannian reconsolidation, Phase 8)
//   • Admin       (stats, health)
//
// ## Multi-collection (Fase B)
// Every data-plane RPC carries an optional `collection` field.
// An empty string routes to the "default" collection.

service NietzscheDB {

  // ── Collection management ──────────────────────────────────────────────
  rpc CreateCollection (CreateCollectionRequest)  returns (CreateCollectionResponse);
  rpc DropCollection   (DropCollectionRequest)    returns (StatusResponse);
  rpc ListCollections  (Empty)                    returns (ListCollectionsResponse);

  // ── Node CRUD ─────────────────────────────────────────────────────────
  rpc InsertNode   (InsertNodeRequest)    returns (NodeResponse);
  rpc GetNode      (NodeIdRequest)        returns (NodeResponse);
  rpc DeleteNode   (NodeIdRequest)        returns (StatusResponse);
  rpc UpdateEnergy (UpdateEnergyRequest)  returns (StatusResponse);

  // ── Edge CRUD ─────────────────────────────────────────────────────────
  rpc InsertEdge (InsertEdgeRequest) returns (EdgeResponse);
  rpc DeleteEdge (EdgeIdRequest)     returns (StatusResponse);

  // ── MERGE (upsert semantic: get-or-create) ────────────────────────────────────
  rpc MergeNode (MergeNodeRequest) returns (MergeNodeResponse);
  rpc MergeEdge (MergeEdgeRequest) returns (MergeEdgeResponse);

  // ── NQL query (Nietzsche Query Language) ─────────────────────────────
  rpc Query (QueryRequest) returns (QueryResponse);

  // ── Vector search (hyperbolic KNN) ───────────────────────────────────
  rpc KnnSearch (KnnRequest) returns (KnnResponse);

  // ── Graph traversal ───────────────────────────────────────────────────
  rpc Bfs      (TraversalRequest) returns (TraversalResponse);
  rpc Dijkstra (TraversalRequest) returns (TraversalResponse);

  // ── Heat-kernel diffusion (Phase 6) ──────────────────────────────────
  rpc Diffuse (DiffusionRequest) returns (DiffusionResponse);

  // ── Reconsolidation sleep cycle (Phase 8) ────────────────────────────
  rpc TriggerSleep (SleepRequest) returns (SleepResponse);

  // ── Sensory Compression Layer (Phase 11) ─────────────────────────────
  rpc InsertSensory   (InsertSensoryRequest)   returns (StatusResponse);
  rpc GetSensory      (NodeIdRequest)          returns (SensoryResponse);
  rpc Reconstruct     (ReconstructRequest)     returns (ReconstructResponse);
  rpc DegradeSensory  (NodeIdRequest)          returns (StatusResponse);

  // ── Zaratustra — autonomous evolution engine (Phase Z) ───────────────
  rpc InvokeZaratustra (ZaratustraRequest)  returns (ZaratustraResponse);

  // ── Batch CRUD ────────────────────────────────────────────────────────
  rpc BatchInsertNodes (BatchInsertNodesRequest) returns (BatchInsertNodesResponse);
  rpc BatchInsertEdges (BatchInsertEdgesRequest) returns (BatchInsertEdgesResponse);

  // ── Graph Algorithms ────────────────────────────────────────────────
  rpc RunPageRank      (PageRankRequest)      returns (AlgorithmScoreResponse);
  rpc RunLouvain       (LouvainRequest)       returns (AlgorithmCommunityResponse);
  rpc RunLabelProp     (LabelPropRequest)     returns (AlgorithmCommunityResponse);
  rpc RunBetweenness   (BetweennessRequest)   returns (AlgorithmScoreResponse);
  rpc RunCloseness     (ClosenessRequest)     returns (AlgorithmScoreResponse);
  rpc RunDegreeCentrality (DegreeCentralityRequest) returns (AlgorithmScoreResponse);
  rpc RunWCC           (WccRequest)           returns (AlgorithmCommunityResponse);
  rpc RunSCC           (SccRequest)           returns (AlgorithmCommunityResponse);
  rpc RunAStar         (AStarRequest)         returns (AStarResponse);
  rpc RunTriangleCount (TriangleCountRequest) returns (TriangleCountResponse);
  rpc RunJaccardSimilarity (JaccardRequest)   returns (SimilarityResponse);

  // ── Backup/Restore ───────────────────────────────────────────────────
  rpc CreateBackup  (CreateBackupRequest)  returns (BackupResponse);
  rpc ListBackups   (Empty)                returns (ListBackupsResponse);
  rpc RestoreBackup (RestoreBackupRequest) returns (StatusResponse);

  // ── Full-Text Search ────────────────────────────────────────────────
  rpc FullTextSearch (FullTextSearchRequest) returns (FullTextSearchResponse);
  rpc HybridSearch   (HybridSearchRequest)  returns (KnnResponse);

  // ── Change Data Capture ──────────────────────────────────────────────
  rpc SubscribeCDC (CdcRequest) returns (stream CdcEvent);

  // ── Admin ─────────────────────────────────────────────────────────────
  rpc GetStats (Empty) returns (StatsResponse);
  rpc HealthCheck (Empty) returns (StatusResponse);

  // ── ListStore (RPUSH/LRANGE) ──────────────────────────────────────────
  rpc ListRPush  (ListPushRequest)   returns (ListPushResponse);
  rpc ListLRange (ListRangeRequest)  returns (ListRangeResponse);
  rpc ListLen    (ListLenRequest)    returns (ListLenResponse);

  // ── Cluster gossip (Phase G) ────────────────────────────────────────
  rpc ExchangeGossip (GossipRequest) returns (GossipResponse);

  // ── Schema Validation ──────────────────────────────────────────────
  rpc SetSchema   (SetSchemaRequest)   returns (StatusResponse);
  rpc GetSchema   (GetSchemaRequest)   returns (GetSchemaResponse);
  rpc ListSchemas (Empty)              returns (ListSchemasResponse);
}

// ── Common primitives ──────────────────────────────────────────────────────

message Empty {}

message StatusResponse {
  string status = 1;   // "ok" | "error"
  string error  = 2;   // set only when status == "error"
}

message PoincareVector {
  repeated double coords = 1;
  uint32          dim    = 2;
}

// ── Collection management messages ────────────────────────────────────────

message CreateCollectionRequest {
  string collection = 1;  // collection name (must be non-empty)
  uint32 dim        = 2;  // vector dimension; 0 → server default (3072)
  string metric     = 3;  // "cosine" | "euclidean" | "poincare" | "lorentz"; empty → "cosine"
}

message CreateCollectionResponse {
  bool   created    = 1;  // false if collection already existed (idempotent)
  string collection = 2;  // echoed collection name
}

message DropCollectionRequest {
  string collection = 1;  // cannot be "default"
}

message CollectionInfoProto {
  string collection = 1;
  uint32 dim        = 2;
  string metric     = 3;
  uint64 node_count = 4;
  uint64 edge_count = 5;
}

message ListCollectionsResponse {
  repeated CollectionInfoProto collections = 1;
}

// ── Node messages ──────────────────────────────────────────────────────────

// Supported values: "Semantic", "Episodic", "Concept", "DreamSnapshot"
// Defaults to "Semantic" if empty.
message InsertNodeRequest {
  string         id         = 1;  // UUIDv4 as string; server auto-generates if empty
  PoincareVector embedding  = 2;
  bytes          content    = 3;  // arbitrary JSON bytes
  string         node_type  = 4;
  float          energy     = 5;  // default 1.0
  string         collection = 6;  // empty → "default"
  int64          expires_at = 7;  // optional TTL: Unix seconds; 0 = never expires
}

message NodeIdRequest {
  string id         = 1;
  string collection = 2;  // empty → "default"
}

message UpdateEnergyRequest {
  string node_id    = 1;
  float  energy     = 2;
  string collection = 3;  // empty → "default"
}

message NodeResponse {
  bool           found           = 1;
  string         id              = 2;
  PoincareVector embedding       = 3;
  float          energy          = 4;
  float          depth           = 5;
  float          hausdorff_local = 6;
  int64          created_at      = 7;  // Unix seconds
  bytes          content         = 8;  // JSON bytes
  string         node_type       = 9;
  int64          expires_at      = 10; // TTL: Unix seconds; 0 = never expires
}

// ── Edge messages ──────────────────────────────────────────────────────────

// Supported values: "Association", "Hierarchical", "LSystemGenerated", "Pruned"
message InsertEdgeRequest {
  string id         = 1;  // UUIDv4; auto-generated if empty
  string from       = 2;
  string to         = 3;
  string edge_type  = 4;
  double weight     = 5;
  string collection = 6;  // empty → "default"
}

message EdgeResponse {
  bool   success = 1;
  string id      = 2;
}

message EdgeIdRequest {
  string id         = 1;
  string collection = 2;  // empty → "default"
}

// ── Merge messages (FASE D — Neo4j MERGE replacement) ────────────────────

message MergeNodeRequest {
  string         collection    = 1;  // empty → "default"
  string         node_type     = 2;  // label to match (e.g. "Topic", "Person")
  bytes          match_keys    = 3;  // JSON: {"name": "value"} — properties to match
  bytes          on_create_set = 4;  // JSON: properties to set on new node
  bytes          on_match_set  = 5;  // JSON: properties to update on existing node
  PoincareVector embedding     = 6;  // optional embedding for new node
  float          energy        = 7;  // energy for new node (default 1.0)
}

message MergeNodeResponse {
  bool         created = 1;    // true if new node was created
  string       node_id = 2;    // UUID of matched/created node
  NodeResponse node    = 3;    // full node data
}

message MergeEdgeRequest {
  string collection    = 1;  // empty → "default"
  string from_node_id  = 2;
  string to_node_id    = 3;
  string edge_type     = 4;  // "Association"|"Hierarchical"|etc.
  bytes  on_create_set = 5;  // JSON properties for new edge
  bytes  on_match_set  = 6;  // JSON properties to update on existing
}

message MergeEdgeResponse {
  bool   created = 1;
  string edge_id = 2;
}

// ── Batch messages ──────────────────────────────────────────────────────────

message BatchInsertNodesRequest {
  repeated InsertNodeRequest nodes      = 1;
  string                     collection = 2;  // empty → "default"
}

message BatchInsertNodesResponse {
  uint32          inserted = 1;
  repeated string node_ids = 2;  // UUIDs of inserted nodes (parallel order)
}

message BatchInsertEdgesRequest {
  repeated InsertEdgeRequest edges      = 1;
  string                      collection = 2;  // empty → "default"
}

message BatchInsertEdgesResponse {
  uint32          inserted = 1;
  repeated string edge_ids = 2;
}

// ── NQL messages ───────────────────────────────────────────────────────────

// Typed query parameter — allows clients to bind $variables in NQL queries.
message QueryParamValue {
  oneof value {
    string string_val   = 1;
    double float_val    = 2;
    int64  int_val      = 3;
    string uuid_val     = 4;   // UUID as string
    VectorParam vec_val = 5;   // for HYPERBOLIC_DIST / SENSORY_DIST
  }
}

message VectorParam {
  repeated double coords = 1;
}

message QueryRequest {
  string nql = 1;  // full NQL query string
  // Bind $param_name → value.  Keys are param names WITHOUT the leading $.
  map<string, QueryParamValue> params = 2;
  string collection = 3;  // empty → "default"
}

message ScalarEntry {
  string column = 1;
  oneof  value {
    double float_val  = 2;
    int64  int_val    = 3;
    string string_val = 4;
    bool   bool_val   = 5;
  }
  bool   is_null = 6;
}

message QueryResponse {
  repeated NodeResponse nodes       = 1;
  // Node pairs returned by edge-traversal queries
  repeated NodePair     node_pairs  = 2;
  // UUIDs returned by DIFFUSE queries
  repeated string       path_ids    = 3;
  string                error       = 4;
  // EXPLAIN plan text
  string                explain     = 5;
  // Aggregation / scalar rows
  repeated ScalarRow    scalar_rows = 6;
}

message ScalarRow {
  repeated ScalarEntry entries = 1;
}

message NodePair {
  NodeResponse from = 1;
  NodeResponse to   = 2;
}

// ── KNN messages ──────────────────────────────────────────────────────────

message KnnRequest {
  repeated double query_coords = 1;
  uint32          k            = 2;
  string          collection   = 3;  // empty → "default"
}

message KnnResult {
  string id       = 1;
  double distance = 2;
}

message KnnResponse {
  repeated KnnResult results = 1;
}

// ── Traversal messages ────────────────────────────────────────────────────

message TraversalRequest {
  string start_node_id = 1;
  uint32 max_depth     = 2;   // BFS max hops; Dijkstra: max settled nodes
  double max_cost      = 3;   // Dijkstra max cumulative distance (0 = ∞)
  float  energy_min    = 4;   // skip nodes below this energy
  uint32 max_nodes     = 5;   // hard cap on visited nodes (0 = default 1000)
  string collection    = 6;   // empty → "default"
}

message TraversalResponse {
  repeated string visited_ids = 1;  // node UUIDs in visit order
  repeated double costs       = 2;  // parallel to visited_ids (Dijkstra only)
}

// ── Diffusion messages ────────────────────────────────────────────────────

message DiffusionRequest {
  repeated string source_ids  = 1;   // seed node UUIDs
  repeated double t_values    = 2;   // diffusion times (e.g. [0.1, 1.0, 10.0])
  uint32          k_chebyshev = 3;   // polynomial order (0 = default 10)
  string          collection  = 4;   // empty → "default"
}

message DiffusionScale {
  double          t        = 1;
  repeated string node_ids = 2;
  repeated double scores   = 3;   // parallel to node_ids
}

message DiffusionResponse {
  repeated DiffusionScale scales = 1;
}

// ── Sleep cycle messages ──────────────────────────────────────────────────

message SleepRequest {
  double noise               = 1;   // perturbation magnitude (default 0.02)
  uint32 adam_steps          = 2;   // Adam steps per node (default 10)
  double adam_lr             = 3;   // Adam learning rate (default 5e-3)
  float  hausdorff_threshold = 4;   // max |ΔH| to commit (default 0.15)
  uint64 rng_seed            = 5;   // 0 = non-deterministic
  string collection          = 6;   // empty → "default"
}

message SleepResponse {
  float  hausdorff_before = 1;
  float  hausdorff_after  = 2;
  float  hausdorff_delta  = 3;
  bool   committed        = 4;
  uint32 nodes_perturbed  = 5;
  uint32 snapshot_nodes   = 6;
}

// ── Stats ─────────────────────────────────────────────────────────────────

message StatsResponse {
  uint64 node_count    = 1;
  uint64 edge_count    = 2;
  string version       = 3;
  uint64 sensory_count = 4;  // Phase 11: total nodes with sensory data
}

// ── Sensory Compression Layer messages (Phase 11) ─────────────────────────

// Supported modality values: "text", "audio", "image", "fused"
message InsertSensoryRequest {
  string         node_id         = 1;   // existing node UUID to attach sensory to
  string         modality        = 2;   // "text" | "audio" | "image" | "fused"
  repeated float latent          = 3;   // pre-compressed Euclidean vector
  bytes          original_shape  = 4;   // JSON-encoded OriginalShape metadata
  uint32         original_bytes  = 5;   // size of the original raw data
  uint32         encoder_version = 6;   // encoder version for decoder compatibility
  bytes          modality_meta   = 7;   // e.g. {"sample_rate":16000,"duration_ms":5000}
  string         collection      = 8;   // empty → "default"
}

message SensoryResponse {
  bool   found                  = 1;
  string node_id                = 2;
  string modality               = 3;
  uint32 dim                    = 4;
  string quant_level            = 5;   // "f32" | "f16" | "int8" | "pq" | "gone"
  float  reconstruction_quality = 6;
  float  compression_ratio      = 7;
  uint32 encoder_version        = 8;
  uint32 byte_size              = 9;   // current storage size
}

message ReconstructRequest {
  string node_id    = 1;
  string quality    = 2;   // "full" | "degraded" | "best_available"
  string collection = 3;   // empty → "default"
}

message ReconstructResponse {
  bool           found          = 1;
  string         node_id        = 2;
  repeated float latent         = 3;   // f32 representation for decoder input
  string         modality       = 4;
  float          quality        = 5;   // actual quality of the returned latent
  bytes          original_shape = 6;   // JSON for decoder to know output dimensions
}

// ── Zaratustra messages (Phase Z) ─────────────────────────────────────────
//
// Invoke the three-phase Zaratustra evolution cycle:
//   Phase 1 · Will to Power   — energy propagation (α × neighbour mean)
//   Phase 2 · Eternal Recurrence — temporal echo snapshots for high-energy nodes
//   Phase 3 · Übermensch       — elite tier identification (top fraction by energy)

message ZaratustraRequest {
  string collection = 1;   // empty → "default"
  // Override defaults from ZARATUSTRA_* env vars for this single invocation.
  float  alpha      = 2;   // propagation coefficient (0 = use server default)
  float  decay      = 3;   // energy decay rate       (0 = use server default)
  uint32 cycles     = 4;   // number of complete cycles to run (0 = 1)
}

message ZaratustraResponse {
  // Will to Power stats
  uint64 nodes_updated       = 1;
  float  mean_energy_before  = 2;
  float  mean_energy_after   = 3;
  float  total_energy_delta  = 4;
  // Eternal Recurrence stats
  uint64 echoes_created      = 5;
  uint64 echoes_evicted      = 6;
  uint64 total_echoes        = 7;
  // Übermensch stats
  uint64 elite_count         = 8;
  float  elite_threshold     = 9;
  float  mean_elite_energy   = 10;
  float  mean_base_energy    = 11;
  repeated string elite_node_ids = 12;  // top-tier node UUIDs
  // Timing
  uint64 duration_ms         = 13;
  uint32 cycles_run          = 14;
}

// ── Graph Algorithm messages ──────────────────────────────────────────────

// -- Requests --

message PageRankRequest {
  string collection          = 1;
  double damping_factor      = 2;   // 0 → default 0.85
  uint32 max_iterations      = 3;   // 0 → default 20
  double convergence_threshold = 4; // 0 → default 1e-7
}

message LouvainRequest {
  string collection    = 1;
  uint32 max_iterations = 2;  // 0 → default 10
  double resolution     = 3;  // 0 → default 1.0
}

message LabelPropRequest {
  string collection    = 1;
  uint32 max_iterations = 2;  // 0 → default 10
}

message BetweennessRequest {
  string collection  = 1;
  uint32 sample_size = 2;  // 0 → exact (all nodes)
}

message ClosenessRequest {
  string collection = 1;
}

message DegreeCentralityRequest {
  string collection = 1;
  string direction  = 2;  // "in" | "out" | "both"; empty → "both"
}

message WccRequest {
  string collection = 1;
}

message SccRequest {
  string collection = 1;
}

message AStarRequest {
  string collection   = 1;
  string start_node_id = 2;
  string goal_node_id  = 3;
}

message TriangleCountRequest {
  string collection = 1;
}

message JaccardRequest {
  string collection = 1;
  uint32 top_k      = 2;  // 0 → default 100
  double threshold   = 3;  // 0 → default 0.0
}

// -- Responses --

message NodeScore {
  string node_id = 1;
  double score   = 2;
}

message AlgorithmScoreResponse {
  repeated NodeScore scores = 1;
  uint64 duration_ms        = 2;
  uint32 iterations         = 3;  // for iterative algorithms
}

message NodeCommunity {
  string node_id      = 1;
  uint64 community_id = 2;
}

message AlgorithmCommunityResponse {
  repeated NodeCommunity assignments = 1;
  uint64 community_count  = 2;
  uint64 largest_size     = 3;
  double modularity       = 4;  // Louvain only
  uint64 duration_ms      = 5;
  uint32 iterations       = 6;
}

message AStarResponse {
  bool            found     = 1;
  repeated string path      = 2;  // node UUIDs from start to goal
  double          cost      = 3;
}

message TriangleCountResponse {
  uint64 count = 1;
}

message SimilarityPairProto {
  string node_a = 1;
  string node_b = 2;
  double score  = 3;
}

message SimilarityResponse {
  repeated SimilarityPairProto pairs = 1;
}

// ── Backup/Restore messages ───────────────────────────────────────────────

message CreateBackupRequest {
  string label = 1;  // user-chosen backup label (e.g. "pre-migration")
}

message BackupInfoProto {
  string label      = 1;
  string path       = 2;
  uint64 created_at = 3;  // Unix seconds
  uint64 size_bytes = 4;
}

message BackupResponse {
  string label      = 1;
  string path       = 2;
  uint64 created_at = 3;
  uint64 size_bytes = 4;
}

message ListBackupsResponse {
  repeated BackupInfoProto backups = 1;
}

message RestoreBackupRequest {
  string backup_path = 1;  // path of the backup to restore
  string target_path = 2;  // where to restore to
}

// ── Full-Text Search messages ─────────────────────────────────────────────

message FullTextSearchRequest {
  string query      = 1;
  uint32 limit      = 2;  // 0 → default 10
  string collection = 3;  // empty → "default"
}

message FtsResultProto {
  string node_id = 1;
  double score   = 2;
}

message FullTextSearchResponse {
  repeated FtsResultProto results = 1;
}

message HybridSearchRequest {
  string          text_query     = 1;  // BM25 text query
  repeated double query_coords   = 2;  // ANN vector query
  uint32          k              = 3;  // top-k results (0 → default 10)
  double          text_weight    = 4;  // RRF weight for BM25 (default 1.0)
  double          vector_weight  = 5;  // RRF weight for KNN (default 1.0)
  string          collection     = 6;  // empty → "default"
}

// ── CDC messages ──────────────────────────────────────────────────────────

message CdcRequest {
  uint64 from_lsn   = 1;  // subscribe from this LSN (0 = from current)
  string collection = 2;  // filter by collection; empty = all collections
}

message CdcEvent {
  uint64 lsn          = 1;  // logical sequence number (monotonically increasing)
  string event_type   = 2;  // INSERT_NODE | UPDATE_NODE | DELETE_NODE | INSERT_EDGE | DELETE_EDGE | BATCH_INSERT_NODES | BATCH_INSERT_EDGES | SLEEP_CYCLE | ZARATUSTRA
  uint64 timestamp_ms = 3;  // Unix milliseconds
  string entity_id    = 4;  // UUID of the mutated entity
  string collection   = 5;  // collection where mutation occurred
  uint32 batch_count  = 6;  // for BATCH_INSERT_* events: number of items inserted
}

// ── ListStore messages ────────────────────────────────────────────────────

message ListPushRequest {
  string node_id    = 1;  // UUID of the node
  string list_name  = 2;  // name of the list (e.g. "history", "tags")
  bytes  value      = 3;  // value to append
  string collection = 4;
}

message ListPushResponse {
  uint64 new_length = 1;  // current sequence number after push
}

message ListRangeRequest {
  string node_id    = 1;
  string list_name  = 2;
  uint64 start      = 3;  // 0-based start index
  int64  stop       = 4;  // 0-based stop index (inclusive, -1 = to end)
  string collection = 5;
}

message ListRangeResponse {
  repeated bytes values = 1;
}

message ListLenRequest {
  string node_id    = 1;
  string list_name  = 2;
  string collection = 3;
}

message ListLenResponse {
  uint64 length = 1;
}

// ── Cluster gossip messages (Phase G) ─────────────────────────────────────

message ClusterNodeProto {
  string id          = 1;  // UUID
  string addr        = 2;  // gRPC address "host:port"
  string name        = 3;  // Human-readable name
  string role        = 4;  // "primary" | "replica" | "coordinator"
  string health      = 5;  // "healthy" | "degraded" | "unreachable"
  uint64 last_seen_ms = 6; // Unix milliseconds
  uint64 token       = 7;  // Consistent-hash partition token
}

message GossipRequest {
  string            sender_id = 1;  // UUID of the sending node
  repeated ClusterNodeProto nodes = 2;  // sender's cluster snapshot
}

message GossipResponse {
  repeated ClusterNodeProto nodes = 1;  // receiver's cluster snapshot (for bidirectional merge)
}

// ── Schema Validation messages ────────────────────────────────────────────

message SchemaFieldType {
  string field_name = 1;
  string field_type = 2;  // "string" | "number" | "bool" | "array" | "object"
}

message SetSchemaRequest {
  string                  node_type       = 1;
  repeated string         required_fields = 2;
  repeated SchemaFieldType field_types    = 3;
  string                  collection      = 4;  // empty → "default"
}

message GetSchemaRequest {
  string node_type  = 1;
  string collection = 2;  // empty → "default"
}

message GetSchemaResponse {
  string                  node_type       = 1;
  repeated string         required_fields = 2;
  repeated SchemaFieldType field_types    = 3;
  bool                    found           = 4;
}

message ListSchemasResponse {
  repeated GetSchemaResponse schemas = 1;
}
